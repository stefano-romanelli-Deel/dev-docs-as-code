#!/bin/sh

echo "üîç Running Vale checks on staged Markdown files in docs/..."

# Get staged markdown files inside docs/ (Added, Copied, Modified, Renamed)
STAGED_MD=$(git diff --cached --name-only --diff-filter=ACMR | grep '^docs/.*\.md$' || true)

if [ -z "$STAGED_MD" ]; then
  echo "‚úÖ No staged Markdown files in docs/ to lint"
  exit 0
fi

FAIL=0

# Process each staged file safely (handles spaces in filenames)
echo "$STAGED_MD" | while IFS= read -r file; do
  if [ -n "$file" ]; then
    vale --minAlertLevel=error "$file"
    RESULT=$?
    if [ $RESULT -ne 0 ]; then
      FAIL=1
    fi
  fi
done

if [ $FAIL -ne 0 ]; then
  echo "‚ùå Commit blocked due to Vale errors"
  exit 1
fi

echo "‚úÖ Vale checks passed"
